(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{525:function(t,e,n){"use strict";var o=n(0),r=n.n(o);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t){return(i="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(t){return a(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":a(t)})(t)}function l(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=function(t){function e(t){var n,o,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=this,(n=!(r=s(e).call(this,t))||"object"!==i(r)&&"function"!=typeof r?c(o):r).getSession=n.getSession.bind(c(n)),n}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,t),n=e,(o=[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null)}},{key:"componentDidMount",value:function(){this.getSession(),this.intervalId=setInterval(this.getSession,17e3)}},{key:"componentWillUnmount",value:function(){this.intervalId&&clearInterval(this.intervalId)}},{key:"getSession",value:function(){var t=this;axios.request({url:"/store/public/admin/lab_sessions/getSession",method:"post"}).then((function(e){(e=e.data).result?t.props.callback&&t.props.callback(e.data):error_handle(e)})).catch((function(t){console.log(t),error_handle(t)}))}}])&&l(n.prototype,o),a&&l(n,a),e}(o.Component);e.a=f},526:function(t,e,n){"use strict";(function(t){var o=n(0),r=n.n(o),a=n(9);function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t){return(l="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(t){return i(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)})(t)}function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}function c(t,e){if(null==t)return{};var n,o,r=function(t,e){if(null==t)return{};var n,o,r={},a=Object.keys(t);for(o=0;o<a.length;o++)n=a[o],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(o=0;o<a.length;o++)n=a[o],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function u(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function f(t,e){return!e||"object"!==l(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var m=function(e){function n(t,e){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(o=f(this,d(n).call(this,t))).state={dragover:"",dragging:""},o.id=makeId(),o}var o,i,l;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(n,e),o=n,(i=[{key:"onDragStart",value:function(e){this.setState({dragging:"dragging"}),e.dataTransfer.setData("src_id",this.props.src_id),t.src_weight=this.props.src_weight}},{key:"onDragEnd",value:function(t){this.setState({dragging:""})}},{key:"onDrop",value:function(e){e.preventDefault();var n=e.dataTransfer.getData("src_id");this.props.changeOrder&&n!=this.props.src_id&&this.props.changeOrder(n,this.props.src_id),this.setState({dragover:""}),delete t.src_weight}},{key:"onDragEnter",value:function(e){e.preventDefault();var n=t.src_weight;Number(n)>Number(this.props.src_weight)?this.setState({dragover:"dragover down"}):Number(n)<Number(this.props.src_weight)&&this.setState({dragover:"dragover up"})}},{key:"onDragLeave",value:function(t){t.preventDefault(),this.setState({dragover:""})}},{key:"render",value:function(){var t=this,e=this.props,n=(e.className,e.changeOrder,e.src_id,e.src_weight,e.icon,e.children,c(e,["className","changeOrder","src_id","src_weight","icon","children"]));return r.a.createElement(r.a.Fragment,null,r.a.createElement(a.a,{id:"drag_sort_css"},"\n\t\t\t\t\t  .dragsort_item.dragover.up::after{\n\t\t\t\t\t\t\tcontent:'';\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\theight: 30px;\n\t\t\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\t\t\tborder: dashed thin;\n\t\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\t\tmargin: 5px 0px;\t\t\n\t\t\t\t  \t  }\n\t\t\t\t\t  .dragsort_item.dragover.down::before{\n\t\t\t\t\t\t\tcontent:'';\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\theight: 30px;\n\t\t\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\t\t\tborder: dashed thin;\n\t\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t\t\tmargin: 5px 0px;\t\n\t\t\t\t\t\t\t\n\t\t\t\t  \t  }\n\t\t\t\t\t  .dragsort_item {\n\t\t\t\t\t\t  padding: 5px 0px;\n\t\t\t\t\t\t  position: relative;\n\t\t\t\t\t\t  cursor: move;\n\t\t\t\t\t  }\n\t\t\t\t\t  .dragsort_item.dragging{\n\t\t\t\t\t\t  border:solid thin orange;\n\t\t\t\t\t  }\n\t\t\t\t\t  .dragsort_item.dragging * {\n\t\t\t\t\t      pointer-events: none;\n\t\t\t\t\t  }\n\t\t\t\t\t  .dragsort_item.dragover *{\n\t\t\t\t\t\tpointer-events: none;\n\t\t\t\t\t  }\n\t\t\t\t\t  \n\t\t\t\t  "),r.a.createElement("div",s({draggable:!0,className:"dragsort_item ".concat(get(this.props.className,"")," ").concat(this.state.dragover," ").concat(this.state.dragging),onDragStart:function(e){t.onDragStart(e)},onDragEnd:function(e){t.onDragEnd(e)},onDrop:function(e){t.onDrop(e)},onDragOver:function(t){t.preventDefault()},onDragEnter:function(e){t.onDragEnter(e)},onDragLeave:function(e){t.onDragLeave(e)}},n),this.props.icon?r.a.createElement("i",{className:"fa fa-arrows",style:{pointerEvents:"none",marginRight:10}}):"",this.props.children))}}])&&u(o.prototype,i),l&&u(o,l),n}(o.Component);e.a=m}).call(this,n(1))},626:function(t,e,n){"use strict";n.r(e);var o=n(0),r=n.n(o),a=(n(732),n(79)),i=n(526);function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t){return(s="function"==typeof Symbol&&"symbol"===l(Symbol.iterator)?function(t){return l(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":l(t)})(t)}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function f(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var m=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=f(this,d(e).call(this,t))).state={workbooks:[],active:""},n.labPath=get(App.parsed.path,""),n.inputComps={},n}var n,o,l;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(e,t),n=e,(o=[{key:"render",value:function(){var t=this;return r.a.createElement("div",{style:{marginTop:15,color:"#337ab7",height:0,flexGrow:1,overflow:"auto"}},r.a.createElement("style",null,"\n                .workbook_name_input{\n                    border: none;\n                    color: #337ab7;\n                    font-weight: bold;\n                    padding: 0px 7px;\n                    background: none;\n                    width:100%;\n                }\n                .dragsort_item.dragover .workbook_item{\n                    transform: scale(1.01);\n                }\n            "),this.state.workbooks.map((function(e){var n;return r.a.createElement(i.a,{src_id:e.name,src_weight:e.weight,key:e.name,changeOrder:function(e,n){t.changeOrder(e,n)}},r.a.createElement("div",(c(n={className:"workbook_item",style:{borderRadius:5,padding:7,background:e.name==t.state.active?"#ffc1074d":"white"},key:e.name},"className","button box_flex box_shadow"),c(n,"onClick",(function(){t.props.onClick(e).then((function(n){n&&t.setState({active:e.name})}))})),n),"pdf"==e.type?r.a.createElement("i",{className:"fa fa-file-pdf-o"}):r.a.createElement("i",{className:"fa fa-file-text-o"}),"  ",r.a.createElement(a.a,{className:"workbook_name_input",value:e.name,onBlur:function(n){return t.editWb(e.name,n.target.value)},ref:function(n){return t.inputComps[e.name]=n}}),r.a.createElement("div",{className:"close",style:{margin:"auto 7px auto auto"},onClick:function(){t.delWb(e.name)}},"×")))})))}},{key:"componentDidMount",value:function(){this.loadWorkbooks()}},{key:"changeOrder",value:function(t,e){var n=this;return axios.request({url:"/api/labs/session/workbook/order",method:"post",data:{src_name:t,dest_name:e}}).then((function(t){App.loading(!1,"Loading..."),"success"==(t=t.data).status?n.loadWorkbooks():error_handle(t)})).catch((function(t){console.log(t),App.loading(!1,"Loading..."),error_handle(t)}))}},{key:"delWb",value:function(t){var e=this;return Swal({title:"Are you sure?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then((function(n){if(n.value)return axios.request({url:"/api/labs/session/workbook/delete",method:"post",data:{name:t}}).then((function(n){if(App.loading(!1,"Loading..."),"success"==(n=n.data).status){var o=e.state.workbooks,r=o.findIndex((function(e){return e.name==t}));-1!=r&&(o.splice(r,1),e.setState({workbooks:o,active:""}),e.props.onClick&&e.props.onClick({}))}else error_handle(n)})).catch((function(t){console.log(t),App.loading(!1,"Loading..."),error_handle(t)}))}))}},{key:"editWb",value:function(t,e){var n=this;if(t!=e&&""!=this.labPath)return App.loading(!0,"Loading..."),axios.request({url:"/api/labs/session/workbook/edit",method:"post",data:{name:t,new_name:e}}).then((function(o){if(App.loading(!1,"Loading..."),"success"==(o=o.data).status){var r=n.state.workbooks,a=r.find((function(e){return e.name==t}));a&&(a.name=e,n.setState({workbooks:r,active:e}))}else n.inputComps[t].setValue(t),error_handle(o)})).catch((function(e){console.log(e),App.loading(!1,"Loading..."),this.inputComps[t].setValue(t),error_handle(e)}))}},{key:"loadWorkbooks",value:function(){var t=this;if(""!=this.labPath)return App.loading(!0,"Loading..."),axios.request({url:"/api/labs/session/workbook",method:"get",data:{}}).then((function(e){if(App.loading(!1,"Loading..."),"success"==(e=e.data).status){var n=e.message.sort((function(t,e){return Number(t.weight)-Number(e.weight)}));t.setState({workbooks:n})}else error_handle(e)})).catch((function(t){console.log(t),App.loading(!1,"Loading..."),error_handle(t)}))}}])&&u(n.prototype,o),l&&u(n,l),e}(o.Component),b=n(6);function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t){return(g="function"==typeof Symbol&&"symbol"===h(Symbol.iterator)?function(t){return h(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":h(t)})(t)}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function w(t,e){return!e||"object"!==g(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var E=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=w(this,k(e).call(this,t))).id=makeId(),n.state={},n}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(e,t),n=e,(o=[{key:"setData",value:function(t){this.setState(t)}},{key:"modal",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"show";"hide"==t?$("#"+this.id).modal("hide"):$("#"+this.id).modal()}},{key:"render",value:function(){var t,e,n=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"modal fade",id:this.id},r.a.createElement("div",{className:"modal-dialog modal-lg modal-dialog-centered"},r.a.createElement("div",{className:"modal-content"},r.a.createElement("div",{className:"modal-header"},r.a.createElement("strong",null,lang("Workbook")),r.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal"},"×")),r.a.createElement("div",{className:"modal-body",style:{textAlign:"initial"}},r.a.createElement("div",{className:"input_item"},r.a.createElement("div",{className:"input_item_text"},lang("Workbook Name")),r.a.createElement("div",{className:""},r.a.createElement(b.a,{className:"input_item_input",ref:function(t){return n.inputName=t},struct:(t={},y(t,INPUT_TYPE,"text"),y(t,INPUT_NULL,!1),t)}))),r.a.createElement("br",null),r.a.createElement("div",{className:"input_item"},r.a.createElement("div",{className:"input_item_text"},lang("Workbook Type")),r.a.createElement("div",{className:""},r.a.createElement(b.a,{className:"input_item_input",ref:function(t){return n.inputType=t},struct:(e={},y(e,INPUT_TYPE,"radio"),y(e,INPUT_NULL,!1),y(e,INPUT_OPTION,{html:"HTML",pdf:"PDF"}),y(e,INPUT_DEFAULT,"html"),e)})))),r.a.createElement("div",{className:"modal-footer"},r.a.createElement("button",{type:"button",className:"button btn btn-primary",onClick:function(){n.createWorkbook()}},lang("Add")),r.a.createElement("button",{type:"button",className:"button btn btn-danger","data-dismiss":"modal"},lang("Close")))))))}},{key:"createWorkbook",value:function(){var t=this,e=this.inputName.getValue();if(null!==e){var n=this.inputType.getValue();if(null!==n)return App.loading(!0,"Loading..."),axios.request({url:"/api/labs/session/workbook/add",method:"POST",dataType:"JSON",data:{name:e,type:n}}).then((function(e){if(App.loading(!1),"success"!=(e=e.data).status)return error_handle(e),!1;t.props.onSuccess&&t.props.onSuccess(e)})).catch((function(t){return console.log(t),App.loading(!1),error_handle(t),!1}))}}}])&&v(n.prototype,o),a&&v(n,a),e}(o.Component),x=n(742);function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t){return(O="function"==typeof Symbol&&"symbol"===S(Symbol.iterator)?function(t){return S(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":S(t)})(t)}function N(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function j(t,e){return(j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var L=function(t){function e(t){var n,o,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=this,(n=!(r=P(e).call(this,t))||"object"!==O(r)&&"function"!=typeof r?C(o):r).state={content:"",change:!1},n.id=makeId(),n.workbook=n.props.workbook,n.checkEdit=n.checkEdit.bind(C(n)),n}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}(e,t),n=e,(o=[{key:"isSave",value:function(){return!this.state.change}},{key:"toBase64",value:function(t){return new Promise((function(e,n){var o=new FileReader;o.readAsDataURL(t),o.onload=function(){return e(o.result)},o.onerror=function(t){return n(t)}}))}},{key:"b64toBlob",value:function(t,e){for(var n=atob(t),o=[],r=0;r<n.length;r+=512){for(var a=n.slice(r,r+512),i=new Array(a.length),l=0;l<a.length;l++)i[l]=a.charCodeAt(l);var s=new Uint8Array(i);o.push(s)}var c=new Blob(o,{type:e});return URL.createObjectURL(c)}},{key:"changeContent",value:function(t){if(""!=t){var e=/data:([^;]+);base64,(.*)/gm.exec(t);if(e)return this.b64toBlob(e[2],e[1])}return""}},{key:"componentDidMount",value:function(){this.loadWorkbook(),window.addEventListener("beforeunload",this.checkEdit)}},{key:"checkEdit",value:function(){if(!this.isSave()){var t=lang("wb_leave_alert");return window.event.returnValue=t,t}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.checkEdit)}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{style:{width:"100%",display:"flex",flexDirection:"column"}},r.a.createElement("div",{className:"box_flex"},r.a.createElement("div",{className:"button btn btn-primary",onClick:function(){t.saveWorkbook()}},"Save"),"  ",r.a.createElement("label",{className:"button btn btn-info box_flex",htmlFor:this.id,style:{margin:0}},r.a.createElement("i",{className:"fa fa-cloud-upload"})," ",lang("Upload PDF file")),r.a.createElement("input",{id:this.id,ref:function(e){return t.input=e},type:"file",accept:"application/pdf",style:{display:"none"},onChange:function(e){if(isset(e.target.files[0])){var n=e.target.files[0];if(n.size>52428800)return void showLog(lang("wb_size_alert"),"warning");t.toBase64(n).then((function(e){t.setState({content:e,change:!0})}))}}})),r.a.createElement("div",{id:"pdf_preview",style:{flexGrow:1,marginTop:15,position:"relative"}},""!=this.state.content?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{position:"absolute",height:50,top:0,width:200,right:70}}),isset(window.chrome)?r.a.createElement("div",{className:"box_flex box_line",style:{position:"absolute",height:45,top:2,width:320,left:2,borderBottomRightRadius:5,backgroundColor:"#343739",color:"white",paddingLeft:15}},this.workbook.name):"",r.a.createElement("iframe",{src:this.changeContent(this.state.content),height:"100%",width:"100%"})):r.a.createElement("div",{className:"alert alert-warning"},lang("No Preview"))),r.a.createElement(x.a,{when:this.state.change,message:function(t){return lang("wb_save_alert")}}))}},{key:"saveWorkbook",value:function(){var t=this;if(isset(App.parsed.path))return App.loading(!0,"Loading..."),axios.request({url:"/api/labs/session/workbook/update",method:"post",data:{name:this.workbook.name,content:this.state.content}}).then((function(e){App.loading(!1,"Loading..."),"success"==(e=e.data).status?(Swal("Success","Save is successful","success"),t.setState({change:!1})):error_handle(e)})).catch((function(t){console.log(t),App.loading(!1,"Loading..."),error_handle(t)}))}},{key:"loadWorkbook",value:function(){var t=this;if(isset(App.parsed.path))return App.loading(!0,"Loading..."),axios.request({url:"/api/labs/session/workbook",method:"get",params:{name:this.workbook.name}}).then((function(e){if(App.loading(!1,"Loading..."),"success"==(e=e.data).status){var n=e.message;t.setState({content:n.content})}else error_handle(e)})).catch((function(t){console.log(t),App.loading(!1,"Loading..."),error_handle(t)}))}}])&&N(n.prototype,o),a&&N(n,a),e}(o.Component),T=n(527),A=n.n(T),D=n(528),R=n.n(D);function B(t){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function I(t){return(I="function"==typeof Symbol&&"symbol"===B(Symbol.iterator)?function(t){return B(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":B(t)})(t)}function W(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function U(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function F(t,e){return(F=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var q=function(t){function e(t){var n,o,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=this,(n=!(r=M(e).call(this,t))||"object"!==I(r)&&"function"!=typeof r?U(o):r).state={content:[],menu:[],page:0,change:!1},n.id=makeId(),n.workbook=n.props.workbook,n.checkEdit=n.checkEdit.bind(U(n)),n}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&F(t,e)}(e,t),n=e,(o=[{key:"isSave",value:function(){return!this.state.change}},{key:"toBase64",value:function(t){return new Promise((function(e,n){var o=new FileReader;o.readAsDataURL(t),o.onload=function(){return e(o.result)},o.onerror=function(t){return n(t)}}))}},{key:"b64toBlob",value:function(t,e){for(var n=atob(t),o=[],r=0;r<n.length;r+=512){for(var a=n.slice(r,r+512),i=new Array(a.length),l=0;l<a.length;l++)i[l]=a.charCodeAt(l);var s=new Uint8Array(i);o.push(s)}var c=new Blob(o,{type:e});return URL.createObjectURL(c)}},{key:"changeContent",value:function(t){if(""!=t){var e=/data:([^;]+);base64,(.*)/gm.exec(t);if(e)return this.b64toBlob(e[2],e[1])}return""}},{key:"componentDidMount",value:function(){this.loadWorkbook(),window.addEventListener("beforeunload",this.checkEdit)}},{key:"checkEdit",value:function(){if(!this.isSave())return window.event.returnValue="If you leave before saving, your changes will be lost.","If you leave before saving, your changes will be lost."}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.checkEdit)}},{key:"changePage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"up",e=this.state.page;if("up"==t)var n=e+1;else n=e-1;this.setPage(n)}},{key:"setPage",value:function(t,e){var n=this;t!=this.state.page?(t<0&&(t=0),t>=this.state.content.length&&(t=this.state.content.length-1),this.setState({page:t},(function(){n.editor&&n.editor.editor&&(n.editor.editor.setData(unescape(atob(n.state.content[t]))),e&&e())}))):e&&e()}},{key:"drawMenu",value:function(){var t=this,e=[];return this.state.menu.filter((function(t){return""==t.parent})).map((function(n,o){e.push(t.drawMenuItem(n,o))})),e}},{key:"drawMenuItem",value:function(t,e){var n=this,o="collapse"+makeId(),a=this.state.menu.filter((function(e){return e.parent==t.id})),l=[];return a.map((function(t,e){l.push(n.drawMenuItem(t,e))})),r.a.createElement("div",{key:t.id,className:"wb_menu_item"+(""==t.parent?"":" tree_item"),style:{zIndex:1e3-e}},r.a.createElement("div",{className:" tree_control"},r.a.createElement(i.a,{src_id:t.id,src_weight:t.weight,changeOrder:function(t,e){n.changeOrder(t,e)}},r.a.createElement("div",{className:"box_flex box_shadow ",style:{padding:5},"data-toggle":"collapse","data-target":"#".concat(o),onClick:function(){n.setPage(t.page,(function(){var e=document.querySelector("[menu_id='".concat(t.id,"']"));e&&e.scrollIntoView({behavior:"smooth"})}))}},0==a.length?r.a.createElement(r.a.Fragment,null,"•"):r.a.createElement("i",{className:"fa icon"})," ",r.a.createElement("input",{type:"text",className:"wb_menu_title_input",value:t.title,onChange:function(e){return n.editMenu(t.id,e.target.value)}})," ",r.a.createElement("div",{className:"box_flex",style:{margin:"auto 7px auto auto",color:"darkgray"}},r.a.createElement("div",{className:"dropdown button"},r.a.createElement("i",{type:"button",className:"fa fa-align-left","data-toggle":"dropdown","data-display":"static","aria-expanded":"false"}),r.a.createElement("div",{className:"dropdown-menu",style:{left:-90}},r.a.createElement("div",{className:"box_flex button",style:{padding:5},onClick:function(e){e.preventDefault(),e.stopPropagation(),n.changeLevel(t.id,"up")}},r.a.createElement("i",{className:"fa fa-angle-double-up button"})," ",lang("Promote")),r.a.createElement("div",{className:"box_flex button",style:{padding:5},onClick:function(e){e.preventDefault(),e.stopPropagation(),n.changeLevel(t.id,"down")}},r.a.createElement("i",{className:"fa fa-angle-double-down button"})," ",lang("Demote"))))," ",r.a.createElement("div",{className:"close",onClick:function(e){e.stopPropagation(),n.setPage(t.page,(function(){n.delMenu(t.id)}))}},"×"))))),r.a.createElement("div",{id:o,className:"collapse tree_expand"},l))}},{key:"editMenu",value:function(t,e){var n=this.state.menu,o=n.find((function(e){return e.id==t}));o&&(o.title=e),this.setState({menu:n,change:!0})}},{key:"addMenu",value:function(t,e){var n=this.state.menu;n.push({id:t,page:this.state.page,title:e,parent:"",weight:makeId()}),this.setState({menu:n,change:!0})}},{key:"delMenu",value:function(t){var e=this.state.menu,n=e.findIndex((function(e){return e.id==t}));if(-1!=n){var o=e[n];e.filter((function(t){return t.parent==o.id})).map((function(t){t.parent=o.parent})),e.splice(n,1)}this.setState({menu:e,change:!0}),this.editor&&(this.editor.editor.commands.get("removeMenu")(t),this.saveContent())}},{key:"changeOrder",value:function(t,e){var n=this.state.menu,o=n.findIndex((function(e){return e.id==t}));if(-1!=o){var r=n[o],a=Number(r.weight),i=n.findIndex((function(t){return t.id==e}));if(-1!=i){var l=n[i],s=Number(l.weight);if(r.id!=l.parent){var c=n.filter((function(t){return Number(t.weight)>=a&&Number(t.weight)<=s||Number(t.weight)<=a&&Number(t.weight)>=s}));if(a>s)c.map((function(t,e){c[e+1]&&(t.weight=c[e+1].weight)}));else{var u=c.length-1;c.map((function(t,e){c[u-e-1]&&(c[u-e].weight=c[u-e-1].weight)}))}r.weight=s,r.parent=l.parent,n=n.sort((function(t,e){return Number(t.weight)-Number(e.weight)})),this.setState({menu:n,change:!0})}}}}},{key:"changeLevel",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"down",n=this.state.menu,o=n.find((function(e){return e.id==t}));if(o){if("down"==e){var r=n.filter((function(t){return t.parent==o.parent&&Number(t.weight)<Number(o.weight)}));if(0==r.length)return;o.parent=r[r.length-1].id}else{var a=n.find((function(t){return t.id==o.parent}));if(!a)return;o.parent=a.parent}this.setState({menu:n})}}},{key:"saveContent",value:function(){if(this.editor){var t=this.state.content;t[this.state.page]=btoa(escape(this.editor.editor.getData())),this.setState({content:t,change:!0})}}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{style:{width:"100%",display:"flex",flexDirection:"column"}},r.a.createElement("div",{className:"box_flex box_border",style:{padding:7}},r.a.createElement("div",{className:"button btn btn-primary",onClick:function(){t.saveWorkbook()}},"Save")," ",r.a.createElement("div",{className:"button btn btn-info",onClick:function(){if(t.state.content.length>99)Swal(lang("Warning"),lang("wb_limit_pages"),"warning");else{var e=t.state.content;e.splice(t.state.page+1,0,"");var n=t.state.page+1;n>=t.state.content.length&&(n=t.state.content.length-1),t.setState({content:e,change:!0},(function(){return t.setPage(n)}))}}},"Add Page")," ",r.a.createElement("div",{className:"button btn btn-danger",onClick:function(e){var n=t.state.content;n.splice(t.state.page,1),t.setState({content:n,change:!0},(function(){return t.setPage(t.state.page)}))},title:"Delete current page"},lang("Delete")),r.a.createElement("div",{className:"box_flex",style:{margin:"auto",color:"#337ab7"}},r.a.createElement("input",{min:0,value:this.state.page+1,onChange:function(e){var n=Number(e.target.value)-1;t.setPage(n)},style:{width:20,textAlign:"center",color:"#337ab7",borderRadius:3,border:"none"}}),"/ ",r.a.createElement("b",null,this.state.content.length)),r.a.createElement("div",{className:"box_flex",style:{margin:"auto 0px auto auto"}},r.a.createElement("i",{className:"fa fa-angle-left button box_border box_shadow",style:{fontSize:24,padding:"0px 7px",borderRadius:2},onClick:function(){return t.changePage("down")}}),"   ",r.a.createElement("i",{className:"fa fa-angle-right button box_border box_shadow",style:{fontSize:24,padding:"0px 7px",borderRadius:2},onClick:function(){return t.changePage("up")}}))),r.a.createElement("div",{className:"preview row",style:{flexGrow:1,position:"relative"}},r.a.createElement("div",{className:"col-sm-3 box_border d-flex",style:{padding:0,flexDirection:"column"}},r.a.createElement("div",{className:"box_shadow",style:{textAlign:"center",fontWeight:"bold",padding:5,color:"#337abd"}},lang("Menu")),r.a.createElement("div",{className:"box_padding wb_menu_frame",style:{height:0,overflow:"auto",flexGrow:1}},r.a.createElement("style",null,'\n                            .wb_menu_title_input{\n                                border: none;\n                                color: #337ab7;\n                                font-weight: bold;\n                                padding: 0px 7px;\n                                background: none;\n                                width:100%;\n                            }\n\n                            .wb_menu_item {\n                                position: relative;\n                            }\n                            .tree_item{\n                                position: relative;\n                            }\n                            .tree_control{\n                                position:relative;\n                                z-index:1\n                            }\n                            .tree_control::BEFORE{\n                               content: "";\n                               bottom: 50%;\n                               position: absolute;\n                               left: -15;\n                               border-bottom: solid thin darkgray;\n                               width: 15px;\n                            }\n                            \n                            .tree_item:last-child::BEFORE {\n                               content: "";\n                               top: 0;\n                               position: absolute;\n                               left: -15;\n                               border-left: solid white;\n                               bottom: 0;\n                            }\n                            \n                            .tree_item:last-child .tree_control::AFTER {\n                                content: "";\n                                top: 0;\n                                position: absolute;\n                                left: -15px;\n                                border-left: solid thin darkgray;\n                                height: 50%;\n                            }\n                            \n                            .tree_expand{\n                                position: relative;\n                                padding-left: 15px; \n                                z-index:0;\n                            }\n                            .tree_expand::BEFORE{\n                               content: "";\n                               position: absolute;\n                               height:100%;\n                               top:-5;\n                               left: 0;\n                               border-left: solid thin darkgray;\n                               z-index: 0;\n                            }\n                            .tree_control .icon::before{\n                                content: "\\f0da";\n                            }\n                            .tree_control [aria-expanded=false] .icon::before{\n                                content: "\\f0da";\n                            }\n                            .tree_control [aria-expanded=true] .icon::before{\n                                content: "\\f0d7";\n                            }\n                        '),this.drawMenu())),r.a.createElement("div",{className:"col-sm-9 d-flex",style:{paddingRight:0}},r.a.createElement("style",null,"\n                        .ck-content{\n                            height: 0px;\n                            flex-grow: 1;\n                        }\n                        .ck-editor__main{\n                            flex-grow: 1;\n                            display: flex;\n                            flex-direction: column;\n                        }\n                        .ck.ck-editor {\n                            position: relative;\n                            display: flex;\n                            flex-direction: column;\n                            flex-grow: 1;\n                        }\n                    "),0==this.state.content.length?r.a.createElement("div",{className:"alert alert-warning",style:{width:"100%",height:50}},lang("No page")):r.a.createElement("div",{className:"d-flex",style:{width:"100%",flexDirection:"column"},onBlur:function(){t.saveContent()}},r.a.createElement(A.a,{ref:function(e){return t.editor=e},editor:R.a,data:"",onInit:function(e){isset(t.state.content[t.state.page])&&e.setData(unescape(atob(t.state.content[t.state.page])))},config:{toolbar:{items:["cpformatButton","undo","redo","|","heading","paddingButton","marginButton","borderButton","backgroundButton","|","bold","italic","underline","link","bulletedList","numberedList","imagemngt","blockQuote","mediaEmbed","|","insertTable","tableColumn","tableRow","mergeTableCells","colorTable","lineTable","paddingTableButton","|","fontSize","fontFamily","fontColor","fontBackgroundColor","alignment","|","iconsButton","|","menuButton"]},link:{decorators:{addTargetToLinks:{mode:"manual",label:"Open in a new tab",attributes:{target:"_blank",rel:"noopener noreferrer"}}}},image:{styles:["full","alignLeft","alignRight"],imgmngt:{browser:!1,type:"base64"}},menu:{onCreate:function(e,n){t.addMenu(e,n)}}}})))),r.a.createElement(x.a,{when:this.state.change,message:function(t){return lang("wb_save_alert")}}))}},{key:"saveWorkbook",value:function(){var t=this;if(isset(App.parsed.path))return App.loading(!0,"Loading..."),axios.request({url:"/api/labs/session/workbook/update",method:"post",data:{name:this.workbook.name,content:this.state.content,menu:this.state.menu}}).then((function(e){App.loading(!1,"Loading..."),"success"==(e=e.data).status?(Swal("Success",lang("Save workbook successfully"),"success"),t.setState({change:!1})):error_handle(e)})).catch((function(t){console.log(t),App.loading(!1,"Loading..."),error_handle(t)}))}},{key:"loadWorkbook",value:function(){var t=this;if(isset(App.parsed.path))return App.loading(!0,"Loading..."),axios.request({url:"/api/labs/session/workbook?name=".concat(this.workbook.name),method:"get"}).then((function(e){if(App.loading(!1,"Loading..."),"success"==(e=e.data).status){var n=e.message,o=get(n.menu,[]),r=get(n.content,[]);o=o.sort((function(t,e){return Number(t.weight)-Number(e.weight)})),t.setState({content:r,menu:o})}else error_handle(e)})).catch((function(t){console.log(t),App.loading(!1,"Loading..."),error_handle(t)}))}}])&&W(n.prototype,o),a&&W(n,a),e}(o.Component),z=n(525);function G(t){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function V(t){return(V="function"==typeof Symbol&&"symbol"===G(Symbol.iterator)?function(t){return G(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":G(t)})(t)}function Y(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function J(t,e){return!e||"object"!==V(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var K=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=J(this,H(e).call(this,t))).state={workbook:{}},n.labPath=App.parsed.path,n.labName=n.labPath.replace(/\//,""),n.wb_editor=null,n}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(e,t),n=e,(o=[{key:"componentDidMount",value:function(){document.title="PNETLab | Create Workbook"}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"box_padding d-flex",style:{flexDirection:"column",flexGrow:1}},r.a.createElement("div",{className:"title",style:{color:"#337ab7"}},"Workbook: ",r.a.createElement("strong",null,this.labName)),r.a.createElement("div",{className:"row",style:{flexGrow:1}},r.a.createElement("div",{className:"col-md-2 d-flex"},r.a.createElement("div",{className:"box_shadow box_padding d-flex",style:{flexGrow:1,flexDirection:"column"}},r.a.createElement("div",null,r.a.createElement("div",{className:"button btn btn-primary",onClick:function(){t.wbModal.modal()}},"Add Workbook")),r.a.createElement(m,{ref:function(e){return t.wbList=e},onClick:function(e){return t.wb_editor&&!t.wb_editor.isSave()?Swal({title:"",text:lang("wb_save_alert"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:lang("Continue")}).then((function(n){return!!n.value&&(t.setState({workbook:e}),!0)})):(t.setState({workbook:e}),Promise.resolve(!0))}}))),r.a.createElement("div",{className:"col-md-10 d-flex",style:{padding:0}},r.a.createElement("div",{className:"box_border box_padding d-flex",style:{flexGrow:1}},"pdf"==this.state.workbook.type?r.a.createElement(L,{workbook:this.state.workbook,key:this.state.workbook.name,ref:function(e){return t.wb_editor=e}}):"","html"==this.state.workbook.type?r.a.createElement(q,{workbook:this.state.workbook,key:this.state.workbook.name,ref:function(e){return t.wb_editor=e}}):""))),r.a.createElement(E,{ref:function(e){return t.wbModal=e},onSuccess:function(){t.wbModal.modal("hide"),t.wbList.loadWorkbooks()}}),r.a.createElement(z.a,{callback:function(t){null!=t&&""!=t||window.close()}}))}}])&&Y(n.prototype,o),a&&Y(n,a),e}(o.Component);e.default=K},732:function(t,e,n){var o=n(733);"string"==typeof o&&(o=[[t.i,o,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(19)(o,r);o.locals&&(t.exports=o.locals)},733:function(t,e,n){(t.exports=n(18)(!1)).push([t.i,".main {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}",""])},742:function(t,e,n){"use strict";var o=n(0),r=n.n(o),a=n(5),i=n.n(a),l=n(85),s=n.n(l);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var f=function(t){function e(){return c(this,e),u(this,t.apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.enable=function(t){this.unblock&&this.unblock(),this.unblock=this.context.router.history.block(t)},e.prototype.disable=function(){this.unblock&&(this.unblock(),this.unblock=null)},e.prototype.componentWillMount=function(){s()(this.context.router,"You should not use <Prompt> outside a <Router>"),this.props.when&&this.enable(this.props.message)},e.prototype.componentWillReceiveProps=function(t){t.when?this.props.when&&this.props.message===t.message||this.enable(t.message):this.disable()},e.prototype.componentWillUnmount=function(){this.disable()},e.prototype.render=function(){return null},e}(r.a.Component);f.propTypes={when:i.a.bool,message:i.a.oneOfType([i.a.func,i.a.string]).isRequired},f.defaultProps={when:!0},f.contextTypes={router:i.a.shape({history:i.a.shape({block:i.a.func.isRequired}).isRequired}).isRequired};var d=f;e.a=d}}]);